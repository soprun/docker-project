version: "3.4"

services:
  nginx:
    image: soprun/sandbox-nginx:latest
    # build:
    #   dockerfile: ./docker/nginx/Dockerfile
    #   context: .
    container_name: nginx
    depends_on:
      - php
    ports: [ 80:80, 443:443 ]
    logging:
      driver: $LOGGING_DRIVER
      options:
        max-size: $LOGGING_OPTIONS_MAX_SIZE
        max-file: $LOGGING_OPTIONS_MAX_FILE

  php:
    image: soprun/sandbox-php:dev
    # build:
    #   dockerfile: ./docker/php/Dockerfile
    #   context: .
    #   target: dev
    container_name: php
    privileged: true
    volumes:
      - ./:/app:rw,consistent
      - ~/.composer/cache:/composer/cache:rw,cached
    depends_on:
      - postgres
      - redis
    logging:
      driver: $LOGGING_DRIVER
      options:
        max-size: $LOGGING_OPTIONS_MAX_SIZE
        max-file: $LOGGING_OPTIONS_MAX_FILE

  postgres:
    image: postgres:13-alpine
    container_name: postgres
    environment:
      - POSTGRES_DB
      - POSTGRES_USERNAME
      - POSTGRES_PASSWORD
    ports: [ 5432 ]

  redis:
    image: redis:6-alpine
    container_name: redis
    ports: [ 6379 ]
