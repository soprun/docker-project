user nginx;

# 1 worker process per CPU core.
# Check max: $ grep processor /proc/cpuinfo | wc -l
worker_processes auto;

error_log /dev/stderr warn;
# it permit you to use /etc/init.d/nginx reload|restart|stop|start
pid /var/run/nginx.pid;

events {
    # Tells worker processes how many people can be served simultaneously.
    # worker_process (2) * worker_connections (2048) = 4096
    # Check max: $ ulimit -n
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    log_format json_combined escape=json
    '{'
        '"time_local":"$time_iso8601",'
        '"client_ip":"$http_x_forwarded_for",'
        '"remote_addr":"$remote_addr",'
        '"remote_user":"$remote_user",'
        '"request":"$request",'
        '"status":"$status",'
        '"body_bytes_sent":"$body_bytes_sent",'
        '"request_time":"$request_time",'
        '"http_referrer":"$http_referer",'
        '"http_user_agent":"$http_user_agent",'
        '"request_id":"$request_id"'
    '}';

    error_log off;
    access_log /dev/stdout json_combined;

    sendfile on;
    #tcp_nopush on;
    keepalive_timeout 65;
    #gzip on;

    include /etc/nginx/conf.d/*.conf;
}
